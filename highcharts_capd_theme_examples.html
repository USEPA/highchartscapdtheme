<!-- Remove this jQuery package if publishing on Drupal -->
<script src="http://code.jquery.com/jquery-git.js"></script>

<!-- Remove "https://epa.gov/" from these if publishing chart on Drupal -->
<!-- On Drupal, include this in the javascript box.-->
<script src="https://epa.gov/sites/all/libraries/js/highcharts7/code/highcharts.js"></script>
<script src="https://epa.gov/sites/all/libraries/js/highcharts7/code/modules/exporting.js"></script>
<script src="https://epa.gov/sites/all/libraries/js/highcharts7/code/modules/export-data.js"></script>
<script src="https://epa.gov/sites/all/libraries/js/highcharts7/code/modules/accessibility.js"></script>
<script src="https://epa.gov/sites/all/libraries/js/highcharts7/code/modules/drilldown.js"></script>

<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

<h2>Pie Chart Template</h2>
<figure class="highcharts-figure">
<div class="centered" id="fuelContainer">&nbsp;</div>
</figure>

<h2>Line Chart Template</h2>
<figure class="highcharts-figure">
<div class="centered" id="lineChartTemplate">&nbsp;</div>
</figure>

<h2>Bar Chart Template</h2>
<figure class="highcharts-figure">
<div class="centered" id="barChartTemplate">&nbsp;</div>
</figure>

<h2>Stacked Bar Chart Template</h2>
<figure class="highcharts-figure">
<div class="centered" id="stackedBarChartTemplate">&nbsp;</div>
</figure>

<h2>Stacked Area Template</h2>
<figure class="highcharts-figure">
<div class="centered" id="stackedAreaTemplate">&nbsp;</div>
</figure>


<!-- CSS starts here. Always wrap in style tag. On Drupal, include this at the top of the javascript box.-->
<style>
#pieChartTemplate{
min-height: 350px;
height: 28vw;
max-height: 750px;
max-width: 700px;
}
#lineChartTemplate {
min-height: 350px;
height: 36vw;
max-height: 450px;
max-width: 800px;
}
#barChartTemplate {
min-height: 350px;
height: 36vw;
max-height: 450px;
max-width: 750px;
}
</style>

<!-- Javascript starts below. Always wrap in script tag. On Drupal, include this in the javascript box.-->

<script>
  //Begin Javascript
  //The following Javascript includes all necessary elements from the power sector dev portal style guide

// Function to align first and last labels differently than the rest on the xAxis
//For Highcharts line charts only
(function (H) {
    H.wrap(H.Tick.prototype, 'renderLabel', function (proceed, xy, old, opacity, index) {
        // Call the original function
        proceed.call(this, xy, old, opacity, index);

        // Exit if not the xAxis
        if (!this.axis.isXAxis) {
            return;
        }

        // Get the chart instance
        const chart = this.axis.chart;

        // Check if at least one series is of type 'line'
        const hasLineSeries = chart.series.some(series => series.type === 'line');
        if (!hasLineSeries) {
            return;
        }

        // Align the first label to the left
        if (this.isFirst) {
            this.label.attr({
                align: 'left',
                x: xy.x
            });
            return;
        }

        // Align the last label to the right
        if (this.isLast) {
            this.label.attr({
                align: 'right',
                x: xy.x
            });
            return;
        }
    });
})(Highcharts);

//Set default font, comma for thousands separator, and decimal point style
//These options apply to multiple charts in the code
Highcharts.setOptions({
    style: {
     fontFamily: 'Source Sans Pro, Source Sans Pro, Clean, sans-serif'
        },
    lang: {
      decimalPoint: '.',
      thousandsSep: ','
    }
});

var $ = jQuery;

//Start pie chart highchart template here
//Set data

const fuelData = [['Gas', 42.7], ['Coal', 16.2], ['Nuclear', 18.6], ['Hydro', 5.9], ['Wind', 10.1],  ['Biomass', 1.1], ['Solar', 4.0], ['Oil', 0.6], ['Geothermal', 0.4], ['Other Fossil Fuel', 0.5], ['Other Unknown Fuel', 0.1], ];
var genColors = ['#EF5E25', '#5C5C5C', '#9287B8', '#237AC3', '#168092', '#4D8055', '#8A984B', '#8E704F', '#C84281', '#B04ADB', '#CD425B'];
	
Highcharts.chart('fuelContainer', {
    chart: {
        plotBackgroundColor: null,
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie'
    },
   tooltip:{
    valueSuffix: '%',
        formatter: function() {
        return '<br/><span style="color:' + this.color + '">\u25CF</span> ' + this.key + ': ' + '<b>' + this.y + '</b>' + '%';
    },
    },
    title: {
        text: 'Electricity Mix, 2023',
        align: 'left',
    },
    accessibility: {
        point: {
            valueSuffix: '%'
        }
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
        },
    series: {
      dataLabels: {
        enabled: true,
        format: '{point.name}: {point.y:.1f}%'
      }
    }
    },
  credits: {
    enabled: false
  },
  colors: genColors,
      exporting: {
      menuItemDefinitions: {
        // Custom definition
        dd: {
          onclick: function() {
            window.open('https://www.epa.gov/egrid/download-data');
          },
          text: 'Download Data'
        }
      },
      buttons: {
        contextButton: {
          menuItems: ['dd', 'downloadPNG', 'downloadPDF', 'downloadJPEG', 'downloadSVG']
        }
      }
    },
    series: [{
        colorByPoint: true,
        data: fuelData,
            }],
  credits: {
    text: 'Source: eGRID',
    href: 'https://www.epa.gov/egrid',
  }
});
//End pie chart highchart template here
	
//Start line chart highchart template here
//Set data here
const currentGenYear = 2023; //Last year included on the line chart
const powerGenYears = [1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023];
const generationData = [2.90, 2.94, 2.93, 3.04, 3.09, 3.19, 3.28, 3.33, 3.46, 3.53, 3.64, 3.58, 3.70, 3.72, 3.81, 3.90, 3.91, 4.01, 3.97, 3.81, 3.97, 3.95, 3.89, 3.90, 3.94, 3.92, 3.92, 3.88, 4.02, 3.97, 3.85, 3.96, 4.07, 4.02];

var generationChart = Highcharts.chart('lineChartTemplate', {
  //Credits is the reference / source at the bottom right of the chart
  credits: {
    text: "Source: EIA Annual Energy Review",
    href: "https://www.eia.gov/totalenergy/data/annual/index.php",
  },
    chart: {
      animation: false,
      marginBottom: 10,
      marginBottom: 50,
      xAxisLabelAlignment: true, //Align first label left and last label right
    },
    title: {
      text: "Demand for Electric Power Generation Has Increased in Recent Years",
      margin: 30,
      align: 'left', //Align title left.
    },
    plotOptions: {
      label: {
        onArea: false
      },
      series: {
        animation: false,
      }
    },
    yAxis: {
      tickInterval: 0.5,
      min: 2.5,
      max: 4.5,
      title: {
            text: 'Generation Terrawatt Hours (TWh)',
            style:{fontWeight: 'bold'},
            textAlign: 'left',
            align: 'high',
            offset: -170,
            x: -200,
            rotation: 0,
            y: -20,
        },
      labels: {
        formatter: 
        function() {
          return this.value;
        }
      },
      gridLineDashStyle: 'dash',
      gridLineColor: '#c9c9c9',
      minorGridLineWidth: 0,
      plotLines: [{
        value: 2.5, 
        width: 1, 
        color: '#2e2e2e',   //set solid black line at the base of the y axis
        zIndex: 2
      }],
    },
    xAxis: {
    min: 0.5,
    max: 32.5,
    categories: powerGenYears,
//Add one to last tickPositions array item each year      
tickPositions: [0, 5, 10, 15, 20, 25, 30, 33],
tickLength: 5,
tickWidth: 1,
tickColor: '#2e2e2e',
tickmarkPlacement: 'on',
labels: {
      rotation: 0,
      step: 1,
        formatter() {
//every 5 years - add 2025 in 2026
        if(this.value == 1990 ||
           this.value == 1995 ||
           this.value == 2000 ||
           this.value == 2005 ||
           this.value == 2010 ||
           this.value == 2015 ||
           this.value == 2020 ||
           this.value == currentGenYear) {
            return this.value
        }
    }
    }
    },
        series: [{
        type: 'line',
        color: "#2273BB",
        lineWidth: 3,
        name: "Generation (TWh)",
        data: generationData, //reference the data array that was set above
        }],
    tooltip: {
      valueSuffix: ''
    },
    legend: {
        enabled: true,
        align: 'right',
        verticalAlign: 'middle',
        layout: 'vertical',
        itemMarginTop: -100,
        itemMarginBottom: 8
    },
    exporting: {
      sourceWidth: 800,
      sourceHeight: 500,
      menuItemDefinitions: {
        // Custom definition
        xls: {
          onclick: function() {
        window.open('https://www.epa.gov/system/files/documents/2025-01/figure-2-eia-generation-data.xlsx');
          },
          text: 'Download data'
        }
      },
      buttons: {
        contextButton: {
          menuItems: ['xls', 'downloadPNG', 'downloadJPEG', 'downloadSVG']
        }
      }
    },
    });
//End highcharts line chart template code


//Start highcharts bar chart template code

//Set data here
const coalCapacityFactorYears = [2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023];
const coalCapacityFactorData = [73, 73, 74, 72, 64, 67, 62, 56, 60, 60, 55, 53, 54, 54, 48, 41, 49, 50, 43];
//Define bar chart highchart template here
var coalCapacityFactorChart = Highcharts.chart('barChartTemplate', {
  //Credits is the reference / source at the bottom right of the chart
  credits: {
    text: "Source: EIA Electric Power Annual",
    href: "https://www.eia.gov/electricity/annual/",
  },
    chart: {
      type: 'column',
      animation: false, //can turn animation on or off (true or false). Sometimes delays load when there are many charts on a page.
      marginBottom: 50,
    },
    title: {
      text: "Operating Coal Sources Have Transitioned From Baseload to Intermediate Power Providers",
      margin: 30,
      align: 'left', //align title left
    },
    plotOptions: {
      label: {
        onArea: false
      },
      column:{
      pointWidth: 20, //This sets the width of the columns on the chart
      },
      series: {
        animation: false,
      }
    },
    yAxis: {
      tickInterval: 10,
      min: 0,
      max: 80,
      title: {
            text: 'Capacity Weighted Capacity Factor',
            style:{fontWeight: 'bold'},
            textAlign: 'left',
            align: 'high',
            offset: -170,
            x: -200,
            rotation: 0,
            y: -20,
        },
      labels: {
        formatter: 
        function() {
          return this.value + "%";
        }
      },
      gridLineDashStyle: 'dash',
      gridLineColor: '#c9c9c9',
      minorGridLineWidth: 0,
      plotLines: [{
        value: 0,
        width: 1,
        color: '#2e2e2e', //set solid black line at 0 on the y axis
        zIndex: 2
      }],
    },
    xAxis: {
    min: 0,
    max: 18,
    categories: coalCapacityFactorYears,
//Add one to last tickPositions array item each year
//18 is set as the last tick for 2023
tickPositions: [0, 5, 10, 15, 18],
tickLength: 5,
tickWidth: 1,
tickColor: '#2e2e2e',
tickmarkPlacement: 'on',
labels: {
      rotation: 0,
      step: 1,
        formatter() {
//every 5 years - add 2025 in 2026
        if(this.value % 5 === 0 ||
           this.value === currentGenYear) {
            return this.value
        }
    }
    }
    },
    series: [{
        name: "Coal Capacity Factor",
        data: coalCapacityFactorData, //reference the data array that was set above
        color: '#5C5C5C'
    }],
    tooltip: {
		headerFormat: '<span style="font-size: 11px">{point.key}</span><br/>',
      shared: true,
      valueSuffix: '%',
      shape: "rect",
      pointFormat: '<span style="color:{series.color}">◼</span> {series.name}: <b>{point.y}</b><br/>'
    },
    legend: {
        enabled: false,
	symbolRadius: 0,
        align: 'right',
        verticalAlign: 'middle',
        layout: 'proximate',
        itemMarginBottom: 8
    },
    exporting: {
      sourceHeight: 500,
      sourceWidth: 800,
      menuItemDefinitions: {
        // Custom definition
        xls: {
          onclick: function() {
            window.open('https://www.epa.gov/system/files/documents/2025-01/figure-5-operating-coal-sources.xlsx');
          },
          text: 'Download data'
        }
      },
      buttons: {
        contextButton: {
          menuItems: ['xls', 'downloadPNG', 'downloadJPEG', 'downloadSVG']
        }
      }
    },
    });
//end highcharts bar chart template code

  
</script>
